@page "/encuestas"
@using frontEndForms.Modelos
@inject HttpClient Http
@inject IJSRuntime JSRuntime
@inject NavigationManager Navigation
@inject DialogService DialogService

<PageTitle>Encuestas</PageTitle>
<CerrarSesion />

<RadzenDataGrid AllowFiltering="true" AllowColumnResize="true" AllowAlternatingRows="false" FilterMode="FilterMode.Advanced" AllowSorting="true" PageSize="5" AllowPaging="true" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true"
                Data="@listaEncuentas" TItem="Encuesta" ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or" SelectionMode="DataGridSelectionMode.Single">
    <HeaderTemplate>
        <RadzenButton Text="Crear nueva encuestra" Click=@CrearNuevaEncuesta />
    </HeaderTemplate>
    <EmptyTemplate>
        <p style="color: lightgrey; font-size: 24px; text-align: center; margin: 2rem;">No hay encuestas por mostrar.</p>
    </EmptyTemplate>
    <Columns>
        <RadzenDataGridColumn TItem="Encuesta" Property="Nombre" Filterable="false" Title="Titulo" Frozen="true" Width="80px" TextAlign="TextAlign.Center" />
        <RadzenDataGridColumn TItem="Encuesta" Property="Descripcion" Title="Descripcion" Frozen="true" Width="160px" />
        <RadzenDataGridColumn TItem="Encuesta" Property="Link" Title="Link" Frozen="true" Width="160px" />
    </Columns>
</RadzenDataGrid>


@code {
    public Encuesta[]? listaEncuentas;
    protected override async Task OnInitializedAsync()
    {
        var token = await JSRuntime.InvokeAsync<string>("localStorage.getItem", "access_token");
        if (string.IsNullOrEmpty(token))
        {
            Navigation.NavigateTo("/");
            return;
        }

        Http.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Bearer", token);
        // try
        // {
        //     listaEncuentas = await Http.GetFromJsonAsync<Encuesta[]>("http://localhost:5029/Encuestas");

        // }
        // catch (Exception)
        // {
        //     Navigation.NavigateTo("/");
        //     return;
        // }
    }

    async Task CrearNuevaEncuesta()
    {
        await DialogService.OpenAsync<CrearEncuesta>($"Crear encuesta",
               null,
               new DialogOptions() { Width = "800px", Height = "512px", Resizable = true, Draggable = true });
    }

    void selectedEmployees()
    {

    }

    async Task refrescarData()
    {
        listaEncuentas = await Http.GetFromJsonAsync<Encuesta[]>("http://localhost:5029/Encuestas");
    }
}
